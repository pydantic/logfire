name: UV Sync Weekly Upgrade

on:
  schedule:
    # Runs every week on Monday at 7 AM UTC
    - cron: '0 7 * * 1'

jobs:
  uv-sync:
    runs-on: ubuntu-latest
    steps:
        - uses: actions/checkout@v4

        - name: Install uv
          uses: astral-sh/setup-uv@v3
          with:
            version: "0.4.12"
            enable-cache: true

        - name: Set up Python 3.12
          run: uv python install 3.12

        - name: Upgrade dependencies
          run: uv sync --python 3.12 --upgrade

        # Commit and push changes if any
        - name: Commit and Push Changes
          run: |
            git config --local user.email "github-actions[bot]@users.noreply.github.com"
            git config --local user.name "GitHub Actions Bot"
            git add .
            git commit -m "Update dependencies via UV Sync" || echo "No changes to commit"
            git push origin automate-uv-sync || echo "No changes to push"
            continue-on-error: true

        # Create Pull Request
        - name: Create Pull Request
          uses: peter-evans/create-pull-request@v5
          with:
            token: ${{ secrets.GITHUB_TOKEN }}
            branch: automate-uv-sync
            title: "Weekly UV Sync Dependency Upgrade"
            body: "This pull request updates dependencies via `uv sync --upgrade`."
            assignees: "alexmojaki"
